<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ğŸŒ¿ çš®å…‹æ•å¤©æ°£ç´€éŒ„ç°¿</title>
    <link rel="icon" type="image/png" href="./icon.jpg" />
    <link rel="apple-touch-icon" href="./icon.jpg" />
    <link rel="apple-touch-icon" sizes="180x180" href="./icon.jpg" />

    <style>
      /* -----------------------------------------
      ğŸŒ¿ Pikmin Adventure Style çš®å…‹æ•å†’éšªç­†è¨˜é¢¨
    -------------------------------------------- */

      :root {
        --leaf-green: #6cbf5f;
        --forest-green: #3b6b41;
        --light-leaf: #a8e6a3;
        --earth-brown: #8b6f54;
        --earth-paper: #faf6e8;
        --sky-blue: #9dd9f3;
        --soft-shadow: rgba(0, 0, 0, 0.15);
        --card-shadow: rgba(0, 0, 0, 0.25);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        font-family: "Verdana", "Noto Sans TC", sans-serif;
      }

      body {
        /* èƒŒæ™¯ä¸»é«” */
        background-image: url("./image.jpg");
        background-size: cover; /* è‡ªå‹•å¡«æ»¿è¢å¹•ï¼ˆæ‰‹æ©Ÿ & æ¡Œæ©Ÿé€šç”¨ï¼‰ */
        background-position: center; /* åœ–ç‰‡ç½®ä¸­ */
        background-repeat: no-repeat; /* ä¸é‡è¤‡ */
        background-attachment: fixed; /* æ¡Œæ©Ÿçœ‹èµ·ä¾†æ›´æ¼‚äº®ï¼ˆè¦–å·®æ•ˆæœï¼‰ */

        /* é¡è‰²è®ŠæŸ”å’Œï¼ˆç–ŠåŠ é€æ˜ç™½è‰²ï¼‰*/
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* é€æ˜æŸ”åŒ–å±¤ï¼ˆä¸æœƒå½±éŸ¿å‰æ™¯ï¼‰*/
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.6); /* â† èª¿æ•´é€æ˜åº¦ï¼š0~1 */
        pointer-events: none; /* ä¸å½±éŸ¿é»æ“Š */
        z-index: -1; /* æ”¾åœ¨èƒŒæ™¯ */
      }

      /* -----------------------------------------
      ğŸŒ¿ é ‚éƒ¨ã€Œæ¢éšªè³‡è¨Šåˆ—ã€
    -------------------------------------------- */
      .status-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.45);
        backdrop-filter: blur(6px);
        border-bottom: 3px solid var(--earth-brown);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .location-pill {
        background: var(--sky-blue);
        color: var(--forest-green);
        padding: 6px 15px;
        border-radius: 12px;
        border: 3px solid white;
        font-size: 1.2rem;
        font-weight: bold;
        box-shadow: 3px 3px 0 var(--earth-brown);
      }

      .update-pill {
        font-size: 0.85rem;
        padding: 4px 10px;
        background: var(--earth-brown);
        color: #fff;
        border-radius: 8px;
        box-shadow: 2px 2px 0 var(--forest-green);
      }

      .container {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
      }

      /* -----------------------------------------
      ğŸŒ¿ ä»Šæ—¥ç„¦é»å¡ç‰‡ï¼ˆå†’éšªç­†è¨˜ï¼‰
    -------------------------------------------- */
      .hero-card {
        background: var(--earth-paper);
        border-radius: 25px;
        padding: 25px;
        box-shadow: 6px 6px 0 var(--earth-brown);
        border: 3px dashed var(--earth-brown);
        position: relative;
        margin-bottom: 25px;
      }

      .hero-period {
        position: absolute;
        top: -15px;
        left: 20px;
        background: var(--light-leaf);
        color: var(--forest-green);
        padding: 5px 15px;
        border-radius: 12px;
        font-weight: bold;
        border: 3px solid white;
        box-shadow: 3px 3px 0 var(--forest-green);
        transform: rotate(-3deg);
      }

      .hero-temp-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin: 20px 0;
      }

      .hero-icon {
        font-size: 4.8rem;
        animation: pikminBounce 3s infinite;
      }

      @keyframes pikminBounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      .hero-temp {
        font-size: 4.2rem;
        font-weight: bold;
        color: var(--forest-green);
      }

      .hero-desc {
        font-size: 1.3rem;
        font-weight: bold;
        text-align: center;
        color: var(--earth-brown);
        margin-bottom: 15px;
      }

      /* -----------------------------------------
      ğŸŒ¿ å†’éšªå»ºè­°å¡ç‰‡
    -------------------------------------------- */
      .advice-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 15px;
      }

      .advice-item {
        background: var(--sky-blue);
        padding: 10px;
        border-radius: 15px;
        text-align: center;
        border: 3px solid white;
        box-shadow: 4px 4px 0 var(--forest-green);
      }

      .advice-icon {
        font-size: 2rem;
      }

      .advice-text {
        font-size: 1.1rem;
        font-weight: bold;
        margin-top: 5px;
        color: var(--forest-green);
      }

      /* -----------------------------------------
      ğŸŒ¿ ç¨å¾Œé å ±ï¼ˆå†’éšªä¾¿æ¢å°å¡ï¼‰
    -------------------------------------------- */
      .section-title {
        font-size: 1.3rem;
        color: white;
        font-weight: bold;
        margin-bottom: 10px;
        text-shadow: 2px 2px 0 var(--forest-green);
      }

      .scroll-container {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding-bottom: 10px;
        scrollbar-width: none;
      }
      .scroll-container::-webkit-scrollbar {
        display: none;
      }

      .mini-card {
        min-width: 140px;
        background: var(--earth-paper);
        border-radius: 20px;
        padding: 15px;
        text-align: center;
        border: 3px dashed var(--earth-brown);
        box-shadow: 4px 4px 0 var(--earth-brown);
        transform: rotate(-2deg);
      }

      .mini-time {
        background: var(--light-leaf);
        padding: 4px 10px;
        border-radius: 10px;
        font-weight: bold;
        margin-bottom: 8px;
        border: 2px solid white;
      }

      /* -----------------------------------------
      ğŸŒ¿ Loading ç•«é¢ï¼ˆçš®å…‹æ•æ¢éšªæ°£æ°›ï¼‰
    -------------------------------------------- */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--leaf-green);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
      }
    </style>
  </head>

  <body>
    <div id="loading" class="loading-screen">
      <div style="font-size: 4rem; animation: pikminBounce 2s infinite">ğŸŒ±</div>
      <p style="color: white; font-weight: bold; margin-top: 20px">
        æ­£åœ¨å–šé†’çš®å…‹æ•å€‘â€¦
      </p>
    </div>

    <div class="status-bar">
      <div class="location-pill">ğŸ“ æ¢ç´¢ä¸­â€¦</div>
      <div id="updateTime" class="update-pill">æ›´æ–°ä¸­</div>
    </div>

    <div class="container" id="mainContent" style="display: none">
      <div id="heroCard"></div>
      <h3 class="section-title">ç¨å¾Œå¤©æ°£</h3>
      <div class="scroll-container" id="futureForecasts"></div>
    </div>

    <script>
      const API_BASE = "https://weather-yccfamily.zeabur.app/api/weather";

      function getWeatherIcon(weather) {
        if (!weather) return "ğŸŒ¤ï¸";
        if (weather.includes("æ™´")) return "â˜€ï¸";
        if (weather.includes("å¤šé›²")) return "â›…";
        if (weather.includes("é™°")) return "â˜ï¸";
        if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
        if (weather.includes("é›·")) return "â›ˆï¸";
        return "ğŸŒ±";
      }

      function getAdvice(rainProb, maxTemp) {
        let rainIcon = "ğŸŒ¿";
        let rainText = "å¤©æ°£ç©©å®š";

        if (parseInt(rainProb) > 30) {
          rainIcon = "ğŸƒ";
          rainText = "å¯èƒ½æœƒä¸‹é›¨";
        }

        let clothIcon = "ğŸ§¢";
        let clothText = "æ™®é€šç©¿æ­";

        if (parseInt(maxTemp) >= 28) {
          clothIcon = "ğŸ‘•";
          clothText = "çŸ­è¢–èˆ’é©";
        } else if (parseInt(maxTemp) <= 20) {
          clothIcon = "ğŸ§¥";
          clothText = "åŠ ä»¶å¤–å¥—";
        }

        return { rainIcon, rainText, clothIcon, clothText };
      }

      function getTimePeriod(startTime) {
        const hour = new Date(startTime).getHours();
        if (hour >= 5 && hour < 11) return "æ—©æ™¨";
        if (hour >= 11 && hour < 14) return "ä¸­åˆ";
        if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
        if (hour >= 18 && hour < 23) return "æ™šä¸Š";
        return "æ·±å¤œ";
      }

      function renderWeather(data) {
        const forecasts = data.forecasts;
        const current = forecasts[0];

        document.querySelector(".location-pill").innerHTML = `ğŸ“ ${data.city}`;

        const advice = getAdvice(current.rain, current.maxTemp);

        const period = getTimePeriod(current.startTime);
        const avgTemp = Math.round(
          (parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2
        );

        document.getElementById("heroCard").innerHTML = `
        <div class="hero-card">
          <div class="hero-period">${period}</div>
          <div class="hero-temp-container">
            <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
            <div class="hero-temp">${avgTemp}Â°</div>
          </div>
          <div class="hero-desc">${current.weather}</div>

          <div class="advice-grid">
            <div class="advice-item">
              <div class="advice-icon">${advice.rainIcon}</div>
              <div class="advice-text">${advice.rainText}</div>
            </div>

            <div class="advice-item">
              <div class="advice-icon">${advice.clothIcon}</div>
              <div class="advice-text">${advice.clothText}</div>
            </div>
          </div>
        </div>
      `;

        const today = new Date().getDate();
        const scroll = document.getElementById("futureForecasts");
        scroll.innerHTML = "";

        forecasts.slice(1).forEach((f) => {
          const fDate = new Date(f.startTime).getDate();
          let p = getTimePeriod(f.startTime);
          if (fDate !== today) p = "æ˜å¤©" + p;

          scroll.innerHTML += `
          <div class="mini-card">
            <div class="mini-time">${p}</div>
            <div style="font-size:2.4rem">${getWeatherIcon(f.weather)}</div>
            <div style="font-size:1.1rem;font-weight:bold">${f.minTemp}Â° ~ ${
            f.maxTemp
          }Â°</div>
            <div style="font-size:0.8rem;margin-top:5px;color:#666">ğŸ’§${
              f.rain
            }</div>
          </div>
        `;
        });

        const now = new Date();
        const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
        document.getElementById("updateTime").innerText = `${
          now.getMonth() + 1
        }æœˆ${now.getDate()}æ—¥ (${days[now.getDay()]})`;
      }

      function fetchWeatherByGPS() {
        if (!navigator.geolocation) {
          loadWeather(API_BASE);
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const url = `${API_BASE}?lat=${lat}&lon=${lon}`;
            loadWeather(url);
          },
          () => {
            loadWeather(API_BASE);
          }
        );
      }

      async function loadWeather(url) {
        try {
          const delay = new Promise((r) => setTimeout(r, 1500));
          const dataPromise = fetch(url).then((r) => r.json());
          const [_, result] = await Promise.all([delay, dataPromise]);

          renderWeather(result.data);

          document.getElementById("loading").style.display = "none";
          document.getElementById("mainContent").style.display = "block";
        } catch (err) {
          alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼");
        }
      }

      document.addEventListener("DOMContentLoaded", fetchWeatherByGPS);
    </script>
  </body>
</html>
